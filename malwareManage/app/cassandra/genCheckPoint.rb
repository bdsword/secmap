require 'cassandra'

def genRail(index, taskID)
	str = "a=Checkpoint.new( :index=>"+index.to_s+", :taskID => "+ taskID + ")\n"
	str += "a.save\n"
	return str
end


fp = File.open("cpRail",'w')

client = Cassandra.new('SECMAP',"192.168.100.107:9160")
count = 100
list = client.get_range_keys(:SUMMARY, :key_count => 100)
first = list[0]
str = genRail(100, list[-1])
fp.write(str)

last = nil
list.each do |sample|
	puts sample
	last = sample
end

while true do
	begin
		list = client.get_range_keys(:SUMMARY, :key_count => 100, :start_key=>last)
	rescue
		next
	end
	flag = false
	list.each do |sample|
		puts sample
		last = sample
		if sample == first
			flag = true
		end
	end
	if flag
		break
	end
	if list.size < 100
		break
	end
	count += 100
	str = genRail(count, list[-1])
	fp.write(str)
	p count
end
fp.close()
